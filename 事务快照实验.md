事务A、B、C（事务A、C在开始各自事务之间事务B提交，事务的隔离级别都是可重复读）

一、没有设置事务快照

事务A：

```
postgres@postgres=>start transaction isolation level repeatable read;
START TRANSACTION
postgres@postgres=>create table t1(id int,name varchar(20));
CREATE TABLE
postgres@postgres=>insert into t1 values(1,'a');
INSERT 0 1
```

事务B：

```
postgres@postgres=>start transaction isolation level repeatable read;
START TRANSACTION
postgres@postgres=>create table t2(id int,name varchar(20));
CREATE TABLE
postgres@postgres=>insert into t2 values(1,'a');
INSERT 0 1
postgres@postgres=>commit;
COMMIT
```

事务C：

```
postgres@postgres=>start transaction isolation level repeatable read;
START TRANSACTION
```


事务A、C查看事务B提交的内容:

事务A：

```
postgres@postgres=>select * from t2;
 id | name 
----+------
(0 rows)
```

事务C：

```
postgres@postgres=>select * from t2;
 id | name 
----+------
  1 | a
(1 row)
```

二、设置事务快照后

事务A：

```
postgres@postgres=>start transaction isolation level repeatable read;
START TRANSACTION
postgres@postgres=>select pg_export_snapshot();
 pg_export_snapshot  
---------------------
 00000003-0000001C-1
(1 row)

postgres@postgres=>create table t1(id int,name varchar(20));
CREATE TABLE
postgres@postgres=>insert into t1 values(1,'a');
INSERT 0 1
```

事务B：

```
postgres@postgres=>start transaction isolation level repeatable read;
START TRANSACTION
postgres@postgres=>create table t2(id int,name varchar(20));
CREATE TABLE
postgres@postgres=>insert into t2 values(1,'a');
INSERT 0 1
postgres@postgres=>commit;
COMMIT
```

事务C：

```
postgres@postgres=>start transaction isolation level repeatable read;
START TRANSACTION
postgres@postgres=>set transaction snapshot '00000003-0000001C-1';
SET
```

事务A、C查看事务B提交的内容:

事务A：

```
postgres@postgres=>select * from t2;
 id | name 
----+------
(0 rows)
```

事务B：

```
postgres@postgres=>select * from t2;
 id | name 
----+------
(0 rows)
```



结论:同步事务快照确实可以达到多个事务看到的是相同的数据库视图（数据同步的效果）



注意事项:事务快照导入必须在可重复读或者序列化的事务隔离级别下设置。

```
postgres@postgres=>start transaction;
START TRANSACTION
postgres@postgres=>set transaction snapshot '00000003-0000001D-1';
ERROR:  a snapshot-importing transaction must have isolation level SERIALIZABLE or REPEATABLE READ
```

